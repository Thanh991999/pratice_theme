class SHTVariantSelector extends HTMLElement{constructor(){super(),this.elms={radio_elms:this.querySelectorAll(".js-variant-radio-item"),radio_container_elms:this.querySelectorAll(".js-variant-radio-container"),form:document.querySelector("#productForm-"+this.dataset.section),price:document.querySelector("#productPrice-"+this.dataset.section),installment_form:document.querySelector("#productFormInstallment-"+this.dataset.section),product_form:document.querySelector(`sht-product-form[data-section="${this.dataset.section}"]`),inventory_tracking:document.querySelector("#inventoryTracking-"+this.dataset.section),variant_picker:document.querySelector("#variantPicker-"+this.dataset.section),quantity_input:document.querySelector("#productQuantity-"+this.dataset.section),slideshow:document.querySelector(`sht-product-slideshow[data-section="${this.dataset.section}"]`),thumb_carousel:document.querySelector(`sht-vertical-carousel[data-section="${this.dataset.section}"]`),product_sticky_info:document.querySelector("#productStickyInfo-"+this.dataset.section),carousel:document.querySelector(`sht-carousel[data-section-id="${this.dataset.section}"]`),variant_options:this.querySelectorAll(".js-variant-option-value")},this.price_selector="#productPrice-"+this.dataset.section,this.inventory_tracking_selector="#inventoryTracking-"+this.dataset.section,this.variant_picker_selector="#variantPicker-"+this.dataset.section,this.quantity_input_selector="#productQuantity-"+this.dataset.section,this.slideshow_selector=`sht-product-slideshow[data-section="${this.dataset.section}"]`,this.selected_variants=null,this.variant_data=null,this.setSelectedVariants(),this.setCurrentVariant(),this.updateProductStickyInfo(),this.updateSelectedVariantsOnOptionName(),this.bindEventHandlers(),this.setUnavailableOptions()}bindEventHandlers(){this.addEventListener("change",this.onVariantChangeHandle.bind(this))}onVariantChangeHandle(){this.setSelectedVariants(),this.setCurrentVariant(),this.toggleAddButton(!0,"",!1),this.toggleAddButtonSticky(!0,"",!1),this.updatePickupAvailability(),this.removeErrorMessage(),this.currentVariant?(this.updateURL(),this.updateVariantInput(),this.renderProductInfo(),this.setActiveMedia(),this.setUnavailableOptions()):(this.toggleAddButton(!0,"",!0),this.toggleAddButtonSticky(!0,"",!0),this.setUnavailable())}updateOptionState(t){this.querySelectorAll(".product-option--sold-out").forEach(t=>{t.classList.remove("product-option--sold-out")}),t||this.selected_variants.forEach(t=>{t=this.querySelector(`.js-variant-item[data-variant-value="${t}"]`);t&&t.closest(".js-variant-option-value")?.classList.add("product-option--sold-out")})}updateSelectedVariantsOnOptionName(){this.selected_variants.forEach(t=>{var e=this.querySelector(`.js-variant-item[data-variant-value="${t}"]`);e&&(e=e.getAttribute("name"),e=this.querySelector(`.js-variant-radio-option-name[data-option-name="${e}"]`))&&(e.innerHTML=t)})}updateProductStickyInfo(){this.elms.product_sticky_info&&(this.elms.product_sticky_info.querySelector(".js-product-sticky-info-variant").innerHTML=this.currentVariant.title,this.elms.product_sticky_info.querySelector(".js-product-sticky-info-price").innerHTML=this.elms.price.innerHTML,this.elms.product_sticky_info.querySelector(".js-quantity-input").value=1,this.elms.product_sticky_info.querySelector(".js-quantity-input").value=1,this.elms.product_sticky_info.querySelector('[name="id"]').value=this.currentVariant.id)}removeErrorMessage(){this.elms.product_form&&this.elms.product_form.handleErrorMessage()}updatePickupAvailability(){var t=document.querySelector("sht-pickup-availability");t&&(this.currentVariant&&this.currentVariant.available?t.fetchAvailability(this.currentVariant.id):(t.removeAttribute("available"),t.innerHTML=""))}renderProductInfo(){fetch(`${this.dataset.url}?variant=${this.currentVariant.id}&section_id=`+this.dataset.section).then(t=>t.text()).then(t=>{var t=(new DOMParser).parseFromString(t,"text/html"),e=this.elms.inventory_tracking,i=t.querySelector(this.inventory_tracking_selector),e=(e&&(e.innerHTML="",i)&&(e.innerHTML=i.innerHTML),this.elms.price),i=t.querySelector(this.price_selector);i&&e&&(e.innerHTML=i.innerHTML),this.elms.price&&this.elms.price.classList.remove("visibility-hidden"),this.elms.quantity_input.querySelector(".js-quantity-input").value=1,this.updateProductStickyInfo(),this.updateSelectedVariantsOnOptionName(),this.elms.slideshow.hide_variant||(e=this.elms.slideshow,i=t.querySelector(this.slideshow_selector),e&&i&&(e.innerHTML=i.innerHTML)),this.toggleAddButton(!this.currentVariant.available,SHThemeLanguage.product.PRODUCT_SOLD_OUT),this.toggleAddButtonSticky(!this.currentVariant.available,SHThemeLanguage.product.PRODUCT_SOLD_OUT)})}updateVariantInput(){[this.elms.form,this.elms.installment_form].forEach(t=>{t&&((t=t.querySelector('input[name="id"]')).value=this.currentVariant.id,t.dispatchEvent(new Event("change",{bubbles:!0})))})}updateURL(){this.currentVariant&&"false"!==this.dataset.updateUrl&&window.history.replaceState({},"",this.dataset.url+"?variant="+this.currentVariant.id)}setActiveMedia(){var t,e;this.currentVariant.featured_media&&(e=this.currentVariant.featured_media.id,t=this.elms.slideshow.querySelector(`sht-carousel-item[data-media-id="${this.dataset.section}-${e}"]`),e=this.elms.slideshow.querySelector(`sht-vertical-carousel-item[data-media-target-id="${this.dataset.section}-${e}"]`),window.matchMedia("(max-width: 1024px)").matches?this.elms.carousel.querySelector(".js-carousel-items").scrollTo({left:t.offsetLeft,behavior:"smooth"}):(this.elms.slideshow.querySelectorAll(".js-product-slideshow-item").forEach(t=>{t.classList.remove("d-block"),this.elms.slideshow.hide_variant&&t.classList.add("d-none")}),this.elms.slideshow.querySelectorAll(".js-product-slideshow-thumb").forEach(t=>{t.classList.remove("d-block")}),t.classList.add("d-block"),this.elms.slideshow.hide_variant&&t.classList.remove("d-none")),e&&(e.classList.add("d-block"),this.elms.thumb_carousel.querySelector(".js-carousel-items").scrollTo({top:e.offsetTop,behavior:"auto"})),this.elms.slideshow.pauseAllVideo())}setUnavailable(){var t,e=this.elms.form;e&&(t=(e=e.querySelector(".js-product-form-submit-btn")).querySelector(".js-product-form-submit-btn-text"),e)&&(t.textContent=SHThemeLanguage.product.PRODUCT_UNAVAILABLE,this.elms.price)&&this.elms.price.classList.add("visibility-hidden")}getVariantData(){return this.variant_data=this.variant_data||JSON.parse(this.querySelector('[type="application/json"]').textContent),this.variant_data}setCurrentVariant(){this.currentVariant=this.getVariantData().find(t=>!t.options.map((t,e)=>this.selected_variants[e]===t).includes(!1))}toggleAddButton(t=!0,e,i){var s,r=this.elms.form;r&&(s=(r=r.querySelector(".js-product-form-submit-btn")).querySelector(".js-product-form-submit-btn-text"),r)&&(t?(r.setAttribute("disabled","disabled"),e&&(s.textContent=e)):(r.removeAttribute("disabled"),s.textContent=SHThemeLanguage.product.PRODUCT_ADD_TO_CART))}toggleAddButtonSticky(t=!0,e,i){var s,r=document.querySelector("#productStickyForm-"+this.dataset.section);r&&(s=(r=r.querySelector(".js-product-form-submit-btn")).querySelector(".js-product-form-submit-btn-text"),r)&&(t?(r.setAttribute("disabled","disabled"),e&&(s.textContent=e)):(r.removeAttribute("disabled"),s.textContent=SHThemeLanguage.product.PRODUCT_ADD_TO_CART))}toggleUnavailableOptions(e=!1){this.elms.variant_options.forEach(t=>{t.classList.toggle("product-option--unavailable",e)})}setUnavailableOptions(){this.toggleUnavailableOptions(!1),this.variant_data=this.variant_data||this.getVariantData(),this.selected_variant_id=this.elms.form.querySelector('input[name="id"]').value,this.current_variant=this.variant_data.find(t=>t.id===Number(this.selected_variant_id));const{available:r,options:a,options:{length:n}}=this.current_variant;if(2<n){let s=Object.keys(a),t=[];for(let i=0;i<n;i++)for(let e=i+1;e<n;e++){var o;s[i]&&s[e]&&(o=this.variant_data.filter(t=>t.id!=this.selected_variant_id&&t.options[s[i]]===this.current_variant.options[s[i]]&&t.options[s[e]]===this.current_variant.options[s[e]]&&1==t.available),t=[...t,...o])}let e=[],i=[];t.length&&((t=[...t,this.current_variant]).forEach(t=>{t=t.options;e=[...e,...t]}),i=[...new Set(e)],0==r)&&(i=i.filter(t=>!a.includes(t))),this.toggleUnavailableOptions(!0),i.length&&i.forEach(t=>this.querySelector(`[data-value="${t}"]`).classList.toggle("product-option--unavailable",!1))}else if(1<n){let t=[],e=[],i=[];for(let e=0;e<n;e++){var s=this.variant_data.filter(t=>t.id!=this.selected_variant_id&&t.options[e]===this.current_variant.options[e]&&1==t.available);t=[...t,...s]}t.length&&((t=[...t,this.current_variant]).forEach(t=>{t=t.options;e=[...e,...t]}),i=[...new Set(e)],0==r)&&(i=i.filter(t=>!a.includes(t))),this.toggleUnavailableOptions(!0),i.length&&i.forEach(t=>this.querySelector(`[data-value="${t}"]`).classList.toggle("product-option--unavailable",!1))}else{let e=[],t=[],i=this.variant_data.filter(t=>1==t.available);(i=i.length?[...i,this.current_variant]:i).forEach(t=>{t=t.options;e=[...e,...t]}),t=[...new Set(e)],0==r&&(t=t.filter(t=>!a.includes(t))),this.toggleUnavailableOptions(!0),t.length&&t.forEach(t=>this.querySelector(`[data-value="${t}"]`).classList.toggle("product-option--unavailable",!1))}return!0}}class SHTVariantRadios extends SHTVariantSelector{constructor(){super()}setSelectedVariants(){var t=Array.from(this.querySelectorAll(".js-variant-radio-container"));this.selected_variants=t.map(t=>Array.from(t.querySelectorAll(".js-variant-radio-item")).find(t=>t.checked).value)}}customElements.define("sht-variant-radios",SHTVariantRadios);class SHTVariantSelects extends SHTVariantSelector{constructor(){super()}setSelectedVariants(){this.selected_variants=Array.from(this.querySelectorAll(".js-variant-select-item"),t=>t.value)}}customElements.define("sht-variant-selects",SHTVariantSelects);class SHTProductForm extends HTMLElement{constructor(){super(),this.elms={form:this.querySelector("form"),submit_btn:this.querySelector('[type="submit"]'),error_wrapper:this.querySelector(".js-product-form-error-wrapper"),error_message:this.querySelector(".js-product-form-error-message"),spinner:this.querySelector(".js-product-form-spinner"),quantity_input_container:document.querySelector("#productQuantity-"+this.dataset.section),submit_btn_sticky:document.querySelector("sht-product-form-sticky .js-product-form-submit-btn"),error_wrapper_sticky:document.querySelector("sht-product-form-sticky .js-product-form-error-wrapper"),error_message_sticky:document.querySelector("sht-product-form-sticky .js-product-form-error-message"),spinner_sticky:document.querySelector("sht-product-form-sticky .js-product-form-spinner"),sticky_header:document.querySelector("sht-sticky-header"),announcement_bar:document.querySelector("sht-announcement-bar")},this.elms.form.querySelector("[name=id]").disabled=!1,this.cartNotification=document.querySelector("sht-cart-notification-panel"),this.cartDrawer=document.querySelector("sht-cart-drawer"),this.cartDrawerForm=document.querySelector("sht-cart-drawer-form"),this.bindEventHandlers()}bindEventHandlers(){this.elms.form.addEventListener("submit",this.onSubmitHandler.bind(this))}onSubmitHandler(e){if(e.preventDefault(),!this.elms.submit_btn.classList.contains("loading")){this.handleErrorMessage(),this.elms.submit_btn.setAttribute("aria-disabled",!0),this.elms.submit_btn.classList.add("loading"),this.elms.submit_btn_sticky&&(this.elms.submit_btn_sticky.setAttribute("aria-disabled",!0),this.elms.submit_btn_sticky.classList.add("loading")),this.elms.spinner.classList.remove("hidden"),this.elms.spinner_sticky&&this.elms.spinner_sticky.classList.remove("hidden");e={method:"POST",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/javascript"}};let t=this.cartNotification.getSectionsToRender();this.cartDrawer&&(t=[...t,...this.cartDrawer.getSectionsToRender()]);var i=new FormData(this.elms.form);i.append("sections",t.map(t=>t.id)),i.append("sections_url",window.location.pathname),e.body=i,fetch(""+routes.cart_add_url,e).then(t=>t.json()).then(t=>{t.status?this.handleErrorMessage(t.description):(this.elms.sticky_header&&this.elms.sticky_header.dataset.isEnabled&&this.elms.sticky_header.reveal(),this.cartNotification.renderContents(t),this.cartDrawerForm&&this.cartDrawerForm.renderContents(t),this.elms.quantity_input_container&&"add-to-cart"==this.elms.quantity_input_container.dataset.show&&(this.elms.quantity_input_container.classList.remove("d-none"),this.elms.quantity_input_container.querySelector("input").value=1))}).catch(t=>{console.error(t)}).finally(()=>{this.elms.submit_btn.classList.remove("loading"),this.elms.submit_btn.removeAttribute("aria-disabled"),this.elms.submit_btn_sticky&&(this.elms.submit_btn_sticky.classList.remove("loading"),this.elms.submit_btn_sticky.removeAttribute("aria-disabled")),this.elms.spinner.classList.add("hidden"),this.elms.spinner_sticky&&this.elms.spinner_sticky.classList.add("hidden")})}}handleErrorMessage(t=!1){this.elms.error_wrapper.toggleAttribute("hidden",!t),this.elms.error_wrapper_sticky&&this.elms.error_message_sticky&&this.elms.error_wrapper_sticky.toggleAttribute("hidden",!t),t&&(this.elms.error_message.textContent=t,this.elms.error_wrapper_sticky)&&this.elms.error_message_sticky&&(this.elms.error_message_sticky.textContent=t)}}customElements.define("sht-product-form",SHTProductForm);class SHTStickyProductInfo extends HTMLElement{constructor(){super(),this.is_enabled=SHThemeHelper.isTrue(this.dataset.isEnabled),this.section_id=this.dataset.sectionId,this.sticky=this.querySelector(".js-sticky-product-info"),this.sticky_element=document.querySelector("#productStickyInfo-"+this.section_id),this.current_scroll_top=0,this.container_height=0,this.sticky_bounds={},this.style_sticky=window.getComputedStyle(this.sticky),this.style_sticky_margin_bottom=parseInt(this.style_sticky.marginBottom,0),this.container=document.querySelector("#"+this.section_id),this.bindEventHandlers()}createObserver(){this.sticky_bounds=this.sticky.getBoundingClientRect()}bindEventHandlers(){if(!this.is_enabled)return!1;window.addEventListener("scroll",this.onScrollHandle.bind(this),!1)}onScrollHandle(){var t=this.container.offsetTop+this.container.offsetHeight+this.sticky.offsetHeight,e=this.sticky.offsetTop+this.sticky.offsetHeight+this.style_sticky_margin_bottom,i=window.pageYOffset||document.documentElement.scrollTop||0,t=Math.ceil(i)>=t,e=1-e/i;i>this.current_scroll_top&&0<=e&&!t?requestAnimationFrame(this.reveal.bind(this)):i>this.current_scroll_top&&0<=e&&t?requestAnimationFrame(this.hide.bind(this)):i<this.current_scroll_top&&0<=e&&!t?requestAnimationFrame(this.reveal.bind(this)):e<0&&!t&&requestAnimationFrame(this.reset.bind(this)),this.current_scroll_top=i}connectedCallback(){if(!this.is_enabled)return!1}hide(){this.sticky_element.classList.remove("opacity-1"),this.sticky_element.classList.add("hidden-xs","opacity-0")}reveal(){this.sticky_element.classList.add("opacity-1"),this.sticky_element.classList.remove("hidden-xs","opacity-0")}reset(){this.sticky_element.classList.remove("opacity-1"),this.sticky_element.classList.add("hidden-xs","opacity-0")}disconnectedCallback(){window.removeEventListener("scroll",this.onScrollHandle.bind(this))}}customElements.define("sht-sticky-product-info",SHTStickyProductInfo);class SHTQuantityInputSticky extends HTMLElement{constructor(){super(),this.input=this.querySelector('[name="quantity"]'),this.orgInput=document.querySelector("sht-quantity-input #"+this.dataset.srcInputSelector),this.changeEvent=new Event("change",{bubbles:!0}),this.querySelectorAll("button").forEach(t=>t.addEventListener("click",this.onButtonClickHandle.bind(this))),this.orgInput.addEventListener("change",()=>{this.input.value=this.orgInput.value})}onButtonClickHandle(t){t.preventDefault();var e=this.input.value;"plus"===t.currentTarget.dataset.name?this.input.stepUp():this.input.stepDown(),e!==this.input.value&&(this.input.dispatchEvent(this.changeEvent),this.orgInput.value=this.input.value)}}customElements.define("sht-quantity-input-sticky",SHTQuantityInputSticky);class SHTProductFormSticky extends HTMLElement{constructor(){super(),this.elms={form:this.querySelector("form"),submit_btn:this.querySelector('[type="submit"]'),error_wrapper:this.querySelector(".js-product-form-error-wrapper"),error_message:this.querySelector(".js-product-form-error-message"),spinner:this.querySelector(".js-product-form-spinner"),org_form:document.querySelector("sht-product-form #"+this.dataset.srcFrmSelector)},this.bindEventHandlers()}bindEventHandlers(){this.elms.submit_btn.addEventListener("click",this.onClickSubmitButtonHandle.bind(this)),this.elms.form.addEventListener("submit",this.onSubmitHandler.bind(this))}onSubmitHandler(t){t.preventDefault()}onClickSubmitButtonHandle(){this.elms.org_form.dispatchEvent(new Event("submit",{bubble:!0}))}}customElements.define("sht-product-form-sticky",SHTProductFormSticky);