class SHTCartNote extends HTMLElement{constructor(){super(),this.bindEventHandlers()}bindEventHandlers(){this.addEventListener("change",SHThemeHelper.debounce(t=>{t=JSON.stringify({note:t.target.value});fetch(""+window.routes.cart_update_url,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:t})},300))}}customElements.define("sht-cart-note",SHTCartNote);class SHTCartRemoveButton extends HTMLElement{constructor(){super(),this.addEventListener("click",t=>{t.preventDefault(),this.closest("sht-cart-form").updateQuantity(this.dataset.index,0)})}}customElements.define("sht-cart-remove-button",SHTCartRemoveButton);class SHTCartForm extends HTMLElement{constructor(){super(),this.cartDrawer=document.querySelector("sht-cart-drawer"),this.cartDrawerForm=document.querySelector("sht-cart-drawer-form"),this.cartNotification=document.querySelector("sht-cart-notification-panel"),this.totalItems=Array.from(this.querySelectorAll(".js-quantity-input")).reduce((t,e)=>t+parseInt(e.value),0),this.bindEventHandlers()}bindEventHandlers(){this.addEventListener("change",SHThemeHelper.debounce(t=>{this.onChange(t)},300))}onChange(t){"note"!==t.target.name&&this.updateQuantity(t.target.dataset.index,t.target.value,document.activeElement.dataset.name)}getSectionsToRender(){return[{id:"cartForm",section:this.querySelector(".js-cart-form-wrapper").dataset.sectionId,selectors:[".js-cart-form-content-cart-items",".js-cart-form-content-cart-total",".js-cart-form-item_count"]}]}updateQuantity(e,t,n){let r=this.getSectionsToRender();this.cartDrawer&&(r=[...r,...this.cartDrawer.getSectionsToRender()]),this.cartNotification&&(r=[...r,...this.cartNotification.getSectionsToRender()]);t=JSON.stringify({line:e,quantity:t,sections:r.map(t=>t.section),sections_url:window.location.pathname});fetch(""+window.routes.cart_change_url,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:t}).then(t=>t.text()).then(t=>{let r=JSON.parse(t);var t=this.querySelector(".js-cart-form-footer"),t=(this.classList.toggle("cart-content--is-empty",0===r.item_count),t&&t.classList.toggle("d-none",0===r.item_count),this.getSectionsToRender().forEach(e=>{e.selectors.forEach(t=>{(document.getElementById(e.id).querySelector(t)||this.querySelector(t)).innerHTML=this.getSectionInnerHTML(r.sections[e.section],t)})}),this.updateFreeShipNotifications(r),this.updateErrorRegions(e,r.item_count),document.getElementById("cartItem-"+e));t&&(t=t.querySelector(".js-quantity-button--"+n))&&t.focus(),this.cartDrawerForm&&this.cartDrawerForm.renderContents(r),this.cartNotification&&this.cartNotification.getSectionsToRender().forEach(t=>{"header-cart-status"==t.id&&((new DOMParser).parseFromString(r.sections[t.id],"text/html"),document.querySelector(t.space_selector).innerHTML=this.cartNotification.getSectionInnerHTML(r.sections[t.id],t.selector))})}).catch(t=>{this.querySelector(".js-cart-form-errors").textContent=SHThemeLanguage.cart.ERROR})}updateFreeShipNotifications(t){var t=t.sections[document.getElementById("mainCartForm").dataset.sectionId],t=(new DOMParser).parseFromString(t,"text/html"),e=this.querySelector(".js-free-shipping-notification-message"),t=t.querySelector(".js-free-shipping-notification-value");e&&t&&(e.innerHTML=t.innerHTML)}updateErrorRegions(t,e){var r;this.totalItems===e&&((r=this.querySelector("#line-item-error-"+t)).querySelector(".js-cart-form-item-error-message").innerHTML=SHThemeLanguage.cart.QUANTITY_ERROR.replace("[quantity]",this.querySelector("#quantity-"+t).value),r.classList.remove("d-none-important")),this.totalItems=e}getSectionInnerHTML(t,e){return(new DOMParser).parseFromString(t,"text/html").querySelector(e).innerHTML}}customElements.define("sht-cart-form",SHTCartForm);