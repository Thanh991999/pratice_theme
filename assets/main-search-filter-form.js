class SHTMainSearchFilterForm extends HTMLElement{constructor(){super(),this.pathname=window.location.pathname,this.search_grid_container_selector="mainSearchContainer",this.search_count_selector=".js-search-count",this.search_count_heading_selector=".js-search-count-heading",this.active_search_terms_selector=".js-active-filters",this.sort_by_field_selector=".js-filter-form-sorting",this.cached_results=[],this.onActiveFilterClick=this.onActiveFilterClick.bind(this),this.debouncedOnSubmit=SHThemeHelper.debounce(e=>{this.onSubmitHandler(e)},500),this.querySelector("form").addEventListener("input",this.debouncedOnSubmit.bind(this))}onActiveFilterClick(e){e.preventDefault();e=-1==e.currentTarget.href.indexOf("?")?"":e.currentTarget.href.slice(e.currentTarget.href.indexOf("?")+1);this.renderPage(e)}onSubmitHandler(e){e.preventDefault();var t=new FormData(e.target.closest("form")),t=new URLSearchParams(t).toString();this.renderPage(t,e)}renderPage(r,s,e=0){let i=this.buildURL(r);var t,l=this.getReturnedResultsFromCache(i);l?(t=this.refineReturnedResults(l),this.renderFilters(l,s),this.renderReturnedResults(t,r),this.renderProductCount(l),this.renderSortByField(l)):fetch(i).then(e=>{if(e.ok)return e.text();throw new Error(e.status)}).then(e=>{var t=this.refineReturnedResults(e);this.renderFilters(e,s),this.renderReturnedResults(t,r),this.addReturnedResultsToCache(i,e),this.renderProductCount(e),this.renderSortByField(e)}).catch(e=>{console.error(e)})}renderActiveSearchTerms(e,r){var e=(new DOMParser).parseFromString(e,"text/html"),s=e.querySelector(this.active_search_terms_selector);if(s){e=e.querySelectorAll(this.details_selector);let t=e=>{var t=r?r.target.closest(this.details_selector):void 0;return!!t&&e.dataset.index===t.dataset.index};Array.from(e).filter(e=>!t(e)).forEach(e=>{document.querySelector(`[data-index="${e.dataset.index}"]`+this.details_selector).innerHTML=e.innerHTML}),document.querySelector(this.active_search_terms_selector).innerHTML=s.innerHTML}}renderFilters(e,r){var e=(new DOMParser).parseFromString(e,"text/html"),t=e.querySelectorAll("#mainSearchFiltersForm .js-details-filter");Array.from(t).filter(e=>{return e=e,!(!!(t=r?r.target.closest(".js-details-filter"):void 0)&&e.dataset.index===t.dataset.index);var t}).forEach(e=>{document.querySelector(`.js-details-filter[data-index="${e.dataset.index}"]`).innerHTML=e.innerHTML}),this.renderActiveSearchTerms(e)}renderReturnedResults(e,t){document.getElementById(this.search_grid_container_selector).innerHTML=e,this.updateURL(t)}updateURL(e){history.pushState({searchParams:e},"",""+this.pathname+(e&&"?".concat(e)))}refineReturnedResults(e){return(new DOMParser).parseFromString(e,"text/html").getElementById(this.search_grid_container_selector).innerHTML}buildURL(t){var e=this.getSections();let r=null;return e.forEach(e=>{r=`${this.pathname}?section_id=${e.section}&`+t}),r}getReturnedResultsFromCache(t){var e=e=>e.url===t;return!!this.cached_results.some(e)&&this.cached_results.find(e).html}renderProductCount(e){var t=(new DOMParser).parseFromString(e,"text/html").querySelector(this.search_count_selector).innerHTML,t=(document.querySelector(this.search_count_selector).innerHTML=t,(new DOMParser).parseFromString(e,"text/html").querySelector(this.search_count_heading_selector).innerHTML);document.querySelector(this.search_count_heading_selector).innerHTML=t}addReturnedResultsToCache(e,t){this.cached_results=[...this.cached_results,{html:t,url:e}]}getSections(){return[{section:document.querySelector(".js-main-search-result-grid").dataset.id}]}renderActiveSearchTerms(e){e=e.querySelector(this.active_search_terms_selector);e&&(document.querySelector(this.active_search_terms_selector).innerHTML=e.innerHTML)}renderSortByField(e){var e=(new DOMParser).parseFromString(e,"text/html"),t=e.querySelector(this.sort_by_field_selector).innerHTML,t=(document.querySelector(this.sort_by_field_selector).innerHTML=t,e.querySelector(".js-main-search-sort-by-field-hidden"));document.querySelector(".js-main-search-sort-by-field-hidden").value=t.value}}customElements.define("sht-main-search-filter-form",SHTMainSearchFilterForm);class SHTMainSearchFilterFormReset extends HTMLElement{constructor(){super(),this.querySelector(".js-reset-form-btn").addEventListener("click",e=>{e.preventDefault(),(this.closest("sht-main-search-filter-form")||document.querySelector("sht-main-search-filter-form")).onActiveFilterClick(e)})}}customElements.define("sht-main-search-filter-form-reset",SHTMainSearchFilterFormReset);class SHTMainSearchFilterFormPriceRange extends HTMLElement{constructor(){super(),this.filterPriceElms=this.querySelectorAll(".js-filter-price"),this.priceGTEElm=this.querySelector(".js-price-gte"),this.priceLTEElm=this.querySelector(".js-price-lte"),this.bindEventHandlers(),this.setMinAndMaxValues()}bindEventHandlers(){this.filterPriceElms.forEach(e=>e.addEventListener("keyup",e=>{this.adjustToValidValues(e.currentTarget),this.setMinAndMaxValues()})),this.filterPriceElms.forEach(e=>e.addEventListener("input",e=>{this.adjustToValidValues(e.currentTarget),this.setMinAndMaxValues()})),this.filterPriceElms.forEach(e=>e.addEventListener("change",this.onRangeChangeHandle.bind(this)))}onRangeChangeHandle(e){setTimeout(e=>{this.bindDataToPriceSlider()})}setMinAndMaxValues(){this.priceLTEElm.value&&this.priceGTEElm.setAttribute("max",this.priceLTEElm.value),this.priceGTEElm.value&&this.priceLTEElm.setAttribute("min",this.priceGTEElm.value),""===this.priceGTEElm.value&&this.priceLTEElm.setAttribute("min",0),""===this.priceLTEElm.value&&this.priceGTEElm.setAttribute("max",this.priceLTEElm.getAttribute("max"))}adjustToValidValues(e){var t=Number(e.value),r=Number(e.getAttribute("min")),s=Number(e.getAttribute("max"));t<r&&(e.value=r),s<t&&(e.value=s)}setValues(e,t){this.priceGTEElm.value=e,this.priceLTEElm.value=t}bindDataToPriceSlider(){var e=document.querySelector(".js-slider-gte"),t=document.querySelector(".js-slider-lte"),r=document.querySelector("sht-advanced-filter-price-range-slider");e&&(e.value=this.priceGTEElm.value),t&&(t.value=this.priceLTEElm.value),r&&r.fillBgColor()}}customElements.define("sht-main-search-filter-form-range",SHTMainSearchFilterFormPriceRange);class SHTAdvancedFilterPriceRangeSlider extends HTMLElement{constructor(){super(),this.elms={input_elms:this.querySelectorAll(".js-price-range-slider-input"),lte_slider_elm:this.querySelector(".js-slider-lte"),gte_slider_elm:this.querySelector(".js-slider-gte"),min_gap:0,slider_track:this.querySelector(".js-range-slider-bar"),lte_elm:document.querySelector(".js-price-lte"),gte_elm:document.querySelector(".js-price-gte")},this.reverse=!1,this.color=this.dataset.sliderColor,this.color_shadow=this.dataset.sliderColorShadow,this.bindEventHandlers(),this.fillBgColor(this.reverse)}bindEventHandlers(){this.elms.input_elms.forEach(e=>e.addEventListener("input",this.onRangeSliderChangeHandle.bind(this)))}onRangeSliderChangeHandle(e){this.adjustToValidValues(e)}adjustToValidValues(e){let t=this.elms.gte_slider_elm.value,r=this.elms.lte_slider_elm.value;var s;Number(t)>Number(r)&&(s=r,r=t,t=s,this.reverse=!0),this.fillBgColor(),this.closest("sht-main-search-filter-form-range").setValues(t,r)}fillBgColor(){let e=this.elms.gte_slider_elm.value/this.elms.gte_slider_elm.max*100,t=this.elms.lte_slider_elm.value/this.elms.lte_slider_elm.max*100;this.reverse&&(e=this.elms.lte_slider_elm.value/this.elms.lte_slider_elm.max*100,t=this.elms.gte_slider_elm.value/this.elms.gte_slider_elm.max*100,this.reverse=!1),this.elms.slider_track.style.background=`linear-gradient(to right, ${this.color_shadow} ${e}%, ${this.color} ${e}%, ${this.color} ${t}%, ${this.color_shadow} ${t}%)`}}customElements.define("sht-advanced-filter-price-range-slider",SHTAdvancedFilterPriceRangeSlider);class SHTMainCollectionProductSortByField extends HTMLElement{constructor(){super(),this.selectElement=this.querySelector(".js-main-search-sort-by-field-select"),this.sortByFieldHidden=document.querySelector(".js-main-search-sort-by-field-hidden"),this.selectElement.removeAttribute("form"),this.bindEventHandlers()}bindEventHandlers(){this.selectElement.addEventListener("change",e=>{this.sortByFieldHidden&&(this.sortByFieldHidden.value=e.currentTarget.value,this.sortByFieldHidden.dispatchEvent(new Event("input",{bubbles:!0})))})}}customElements.define("sht-main-search-sort-by-field",SHTMainCollectionProductSortByField);